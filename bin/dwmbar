#!/bin/sh
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later
# version.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
# details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see http://www.gnu.org/licenses/.
#
# Copyright (C) Caio Alonso, 2016

if [ hash acpi 2>/dev/null ] && [ $HOSTNAME != 'desktop' ]; then
    battery=$(acpi --battery | grep -i 'discharging')

    # if it is not discharging, it must be charging
    if [ -z "$battery" -a "$battery" != " " ]
    then
        battery="^"
    else
        battery=""
    fi

    battery=" · $battery$(acpi --battery | awk '{print $4}' | tr --delete ',')"
else
    battery=""
fi

vol=$(amixer get Master |\
    grep -m 1 % |\
    awk '{print($6" "$5)}' |\
    tr --delete '[]' |\
    tr --delete ' on' |\
    sed -e 's/[[:space:]]*$//')

clock=" · $(date +'%d/%m/%y (%a) %R')"

status="$vol$battery$clock"
xsetroot -name "$status";
